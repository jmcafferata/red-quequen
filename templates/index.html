<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Red Quequén</title>
    <!-- A chatbot that communicates with an API to give the townspeople of Quequén all the information-->
    <link rel="stylesheet" href="static/style.css" />
    <style></style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $("form").on("submit", function (event) {
          event.preventDefault();
          const message = $("input[name=message]").val();
          if (message.trim() !== "") {
            // replace the search button with searching.gif until the results are returned
            $("button").html(
              '<img class="loading" src="static/searching.gif" alt="searching" />'
            );
            // Check if search_term is not empty
            $.ajax({
              data: {
                message: message,
              },
              type: "POST",
              url: "/",
            }).done(function (data) {
              // replace the searching.gif with the search button
              $("button").html('<img src="static/search.png" alt="search" />');
              // Clear the previous results
              $("#results").html("");
              $(".app-main").css("padding", "24px 36px 24px 36px");

              // erase the input field
              $("input[name=message]").val("");
              $("#results").css("display", "block");
              // append data to the results div
              $("#results").append(data);
              console.log(data);
              findPhoneNumbersAndConvertToLinks();
            });
          } else {
            alert("No entendí");
          }
        });
      });
    </script>
  </head>

  <body>
    <style></style>
    <div id="section">
      <div id="app-container">
        <div id="main-interface">
          <div class="app-title">
            <h1>Hablá con Quequén</h1>
          </div>
          <div class="app-main">
            <form method="POST" action="/">
              <div class="message-input">
                <input
                  class="input-field"
                  placeholder="Escribí o preguntá lo que quieras"
                  type="text"
                  name="message"
                />
                <!-- Search button with png icon -->
                <button><img src="static/search.png" alt="search" /></button>
              </div>
            </form>
            <div id="results"></div>
          </div>
        </div>
      </div>
    </div>
    <script>
      function findPhoneNumbersAndConvertToLinks() {
        const phoneRegex =
          /(\+?\d{1,4}[-.\s]?)?(\d{1,3}[-.\s]?)?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}/g;
        const div = document.getElementById("results");
        const content = div.innerHTML;
        const replacedContent = content.replace(phoneRegex, function (match) {
          return (
            '<a class="phone-link" href="tel:' +
            match.replace(/[-.\s]/g, "") +
            '">' +
            match +
            "</a>"
          );
        });
        div.innerHTML = replacedContent;
      }
      
    </script>
  </body>
</html>
